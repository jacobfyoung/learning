<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Plan V1</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
      color: #2d3748;
      line-height: 1.5;
      font-size: 14px;
    }
    .banner {
      background-color: #d7f73b;
      padding: 8px 16px;
      font-weight: 700;
      text-align: right;
      font-size: 14px;
    }
    .nav {
      display: flex;
      gap: 16px;
      padding: 12px 16px;
      background: #ffffff;
      border-bottom: 1px solid #e1e5e9;
    }
    .nav a {
      text-decoration: none;
      color: #4a5568;
      font-weight: 700;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 4px;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .nav a:hover {
      background-color: #f1f3f4;
      color: #2d3748;
    }
    .nav a.active {
      background-color: #f9e8eb;
      color: rgb(19,244,173);
    }
    .button-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: -10px;
      margin-left: 0px;
      flex-wrap: wrap;
    }
    
    .button-tabs button {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #ffffff;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      color: #6b7280;
      transition: all 0.2s ease;

    }
    
    .button-tabs button:hover {
      background: #f9fafb;
      border-color: #9ca3af;
    }
    
    .button-tabs button.active {
      background: #f3f4f6;
      border-color: #6b7280;
      color: #374151;
    }
    .content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: #ffffff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      border: 1px solid #e1e5e9;
      margin-bottom: 20px;
    }
    .project-title {
      font-size: 20px;
      font-weight: 700;
      color: #4c4a4a;
      margin-bottom: 16px;
      line-height: 1.2;
    }
        .section-title {
      font-size: 16px;
      font-weight: 700;
      color: #4c4a4a;
      margin-bottom: 0px;
      line-height: 1.2;
    }
    .milestone-item-content {
      border: 1px solid #dbdbdb;
      padding: 6px;
      border-radius: 6px;
      min-height: 20px;
      background: #fafafa;
      color: #4a5568;
      line-height: 1.5;
      font-weight: 400;
      font-size: 12px;
      outline: none;
      border-color: #dbdbdb;
    }
        .value-items {
      padding: 6px 6px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #ffffff;
      font-size: 12px;
      font-weight: 500;
      color: #4a5568;
      transition: all 0.2s ease;
    }
            .value-text {
      color: #4a5568;
      line-height: 1.5;
      font-weight: 400;
      font-size: 12px;
    }
    .team-member {
      padding: 8px 0;
      border-bottom: 1px solid #f3f4f6;
      position: relative;
    }
    
    .team-member:last-child {
      border-bottom: none;
    }
    
    .member-name {
      font-weight: 700;
      color: #4c4a4a;
      margin-bottom: 2px;
      font-size: 14px;
      outline: none;
      border: 1px dashed transparent;
      padding: 2px 4px;
      border-radius: 3px;
    }
    
    .member-name:focus {
      border-color: rgb(19,244,173);
      background: #fafafa;
    }
    
    .member-role {
      font-size: 12px;
      color: #6b7280;
      line-height: 1.3;
      outline: none;
      border: 1px dashed transparent;
      padding: 2px 4px;
      border-radius: 3px;
    }
    
    .member-role:focus {
      border-color: rgb(19,244,173);
      background: #fafafa;
    }
    
    .delete-member {
      position: absolute;
      right: 0;
      top: 8px;
      background: #ffeeee00;
      border: 0px solid #fcc;
      color: rgb(139, 139, 139);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    .team-member:hover .delete-member {
      display: flex;
    }
        .stakeholders-member {
      position: relative;
    }
    
    .stakeholders-member:last-child {
      border-bottom: none;
    }
    .stakeholders-member:hover .delete-member {
      display: flex;
    }
        .stakeholders-items {
      padding: 6px 6px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #ffffff;
      font-size: 12px;
      font-weight: 500;
      color: #4a5568;
      transition: all 0.2s ease;
      text-transform: uppercase;
    }        
    .status-section {
      margin-bottom: 14px;
    }
        
    .status-item {
      margin-bottom: 12px;
    }
        
    .status-label {
     font-weight: 700;
     color: #4c4a4a;
     margin-bottom: 2px;
     margin-top: 6px;
     font-size: 13px;
    }
        
    .status-text {
     color: #4a5568;
     line-height: 1.5;
     font-size: 12px;
    }

    .list-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .add-button {
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 12px;
      margin-top: 10px;
      transition: all 0.2s ease;
    }
    .add-button:hover {
      background: #e5e7eb;
      border-color: #9ca3af;
    }
    .milestone-box {
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 12px;
      background: #f9f9f9;
      position: relative; /* make it a positioning container */
    }
    .milestone-title {
      font-weight: 700;
      margin-bottom: 8px;
    }
    .milestone-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    /* Claravine-style color dropdown */
    .color-dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-button {
      background: linear-gradient(to bottom, #ffffff, #f8fafc);
      /*border: 1px solid #cbd5e1;*/
      border-radius: 6px;
      padding: 2px 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      /*box-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.05),
        0 1px 1px rgba(0, 0, 0, 0.03);*/
      min-height: 20px;
    }

    .dropdown-button:hover {
      border-color: #3b82f6;
      background: linear-gradient(to bottom, #ffffff, #f1f5f9);
      box-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 1px 2px rgba(0, 0, 0, 0.06);
    }

    .dropdown-button.open {
      border-color: #2563eb;
      background: linear-gradient(to bottom, #ffffff, #eff6ff);
      box-shadow: 
        0 0 0 2px rgba(37, 99, 235, 0.1),
        0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .color-indicator {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1.1px solid #e2e8f0;
      flex-shrink: 0;
      transition: all 0.2s ease;
    }

.color-indicator.red { 
  background: linear-gradient(135deg, #F24E30, #dc2626); 
  border-color: #C7321A;  /* Darker red border */
}

.color-indicator.green { 
  background: linear-gradient(135deg, #06C47E, #059669); 
  border-color: #04825F;  /* Darker green border */
}

.color-indicator.yellow { 
  background: linear-gradient(135deg, #EBC30F, #d97706); 
  border-color: #C99C05;  /* Darker yellow border */
}
    .color-indicator.clear { 
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      border-color: #94a3b8;
      position: relative;
    }
    .color-indicator.clear::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 6px;
      height: 1px;
      background: #64748b;
      border-radius: 1px;
      transform: translate(-50%, -50%);
    }

    .dropdown-arrow {
      margin-left: auto;
      font-size: 10px;
      color: #64748b;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 700;
    }

    .dropdown-button.open .dropdown-arrow {
      transform: rotate(180deg);
      color: #2563eb;
    }

    .dropdown-menu {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      min-width: 140px;
      background: white;
      border: 1.5px solid #cbd5e1;
      border-radius: 8px;
      box-shadow: 
        0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
      z-index: 1000;
      display: none;
      overflow: hidden;
    }

    .dropdown-menu.open {
      display: block;
      animation: dropdownFadeIn 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes dropdownFadeIn {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown-option {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
      white-space: nowrap;
      color: #475569;
      border-bottom: 1px solid #f1f5f9;
    }

    .dropdown-option:last-child {
      border-bottom: none;
    }

    .dropdown-option:hover {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      color: #1e293b;
    }

    /* Status-specific hover styling */
    .dropdown-option[data-status="clear"]:hover {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
    }
    .dropdown-option[data-status="green"]:hover {
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      color: #047857;
    }
    .dropdown-option[data-status="yellow"]:hover {
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      color: #b45309;
    }
    .dropdown-option[data-status="red"]:hover {
      background: linear-gradient(135deg, #fef2f2, #fecaca);
      color: #b91c1c;
    }

    @media (max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
        padding: 12px;
      }
    }

      /* --- Side Navigation --- */
  .side-nav {
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: 50px; /* collapsed width */
    background-color: #ffffff;
    color: #4a5568;
    overflow-x: hidden;
    transition: width 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    z-index: 1000;
    font-weight: 700;
    font-size: 13px;
  }

  .side-nav.expanded {
    width: 200px; /* expanded width */
  }

  .side-nav .nav-links {
    display: flex;
    flex-direction: column;
    padding: 10px 0;
  }

  .side-nav .nav-links a {
    padding: 10px 16px;
    text-decoration: none;
    color: #4a5568;
    font-size: 14px;
    display: block;
    white-space: nowrap;
    transition: background 0.2s ease;
  }

  .side-nav .nav-links a:hover {
    background-color: #333;
  }

  .side-nav-toggle {
    background: #333;
    color: #fff;
    text-align: center;
    padding: 8px;
    cursor: pointer;
    font-size: 12px;
  }

  /* Shift page content when sidebar is open */
  .content {
    margin-left: 50px; /* collapsed sidebar space */
    transition: margin-left 0.3s ease;
  }

  .side-nav.expanded ~ .content {
    margin-left: 200px; /* expanded sidebar space */
  }

   /* --- Comments Panel --- */
  .comments-panel {
    position: fixed;
    bottom: 0;
    left: 50px;   /* match collapsed sidebar width */
    right: 0;
    height: 0;
    background: #ffffff;
    border-top: 1px solid #ddd;
    box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    z-index: 999;
    overflow: hidden;
  }
  .side-nav.expanded ~ .comments-panel {
  left: 200px; /* match expanded sidebar width */
}

  .comments-panel.open {
    height: 200px; /* expanded height */
  }

  .comments-header {
    background: #f3f4f6;
    padding: 8px 12px;
    font-weight: 700;
    font-size: 13px;
    border-bottom: 1px solid #e1e5e9;
  }

  .comments-body {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 13px;
    color: #333;
  }

  .comment-input {
    display: flex;
    border-top: 1px solid #e1e5e9;
  }

  .comment-input textarea {
    flex: 1;
    border: none;
    padding: 8px;
    resize: none;
    font-size: 13px;
    font-family: inherit;
    outline: none;
  }

  .comment-input button {
    background: #1a73e8;
    color: #fff;
    border: none;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 700;
  }

  .comment-item {
    padding: 6px 0;
    border-bottom: 1px solid #f1f1f1;
  }

  .comment-item:last-child {
    border-bottom: none;
  }

  /* Make room when panel is open */
  .comments-panel.open ~ .content {
    margin-bottom: 200px;
  }

/* MILESTONE ICONS */
  milestone-box {
  position: relative; /* make it a positioning container */
}

.milestone-toolbar {
  position: absolute;
  top: 6px;
  right: 8px;
  display: flex;
  gap: 10px;
  font-size: 13px;
  color: #6b7280;
}

.milestone-toolbar span {
  display: flex;
  align-items: center;
  gap: 3px;
  cursor: pointer;
  user-select: none;
}

.milestone-toolbar span:hover {
  color: #111;
}

.milestone-toolbar .count {
  min-width: 12px;
  text-align: right;
  font-weight: 700;
  font-size: 12px;
}
  .milestone-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
    margin: 4px 0;
    background: #f9fafb;
    border-radius: 6px;
    font-size: 14px;
  }

  .milestone-item-left {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
  }

  .milestone-month {
    cursor: pointer;
    /*border: 1px dashed #ccc;
    padding: 6px;
    border-radius: 6px;
    min-height: 20px;
    border-color: #999;
    line-height: 1.5;*/
    background: #fafafa;
    color: #4a5568;
    font-weight: 700;
    font-size: 12px;
    border: none;
    appearance: none;        /* removes arrow (most browsers) */
  -webkit-appearance: none; /* Safari/Chrome */
  -moz-appearance: none;   /* Firefox */
  padding-right: 0;        /* prevents extra arrow spacing */
  }

  .milestone-item-content {
    flex: 1;
  }

  .milestone-item-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #555;
  }

  .milestone-item-meta .count {
    min-width: 16px;
    text-align: right;
  }

  .milestone-item-meta button {
    border: none;
    background: #e5e7eb;
    border-radius: 4px;
    padding: 2px 6px;
    cursor: pointer;
    font-weight: 700;
  }

  .milestone-item-meta button:hover {
    background: #d1d5db;
  }

  /* Make resource items visually match stakeholders */
.resource-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px;
  border: 1px solid #d1d5db;      /* matches your milestone/side-nav border */
  border-radius: 4px;
  background: #ffffff;
  font-size: 12px;
  margin-bottom: 8px;
}
.resource-item a {
  text-decoration: none;
  color: #1f2937;
  font-weight: 700;
  overflow-wrap: anywhere;
}
.resource-item .delete-resource {
  background: transparent;
  border: none;
  font-size: 16px;
  line-height: 1;
  cursor: pointer;
  color: #6b7280;
}
.resource-item .delete-resource:hover { color: #111827; }

/* Inline add form */
.resource-form {
  display: none;                   /* toggled by JS */
  gap: 8px;
  margin-top: 8px;
}
.resource-form input {
  flex: 1;
  padding: 8px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 12px;
}
.resource-form .save-btn,
.resource-form .cancel-btn {
  padding: 8px 10px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  background: #f9fafb;
  cursor: pointer;
  font-size: 12px;
  font-weight: 700;
}
.resource-form .save-btn:hover,
.resource-form .cancel-btn:hover {
  background: #f3f4f6;            /* same light hover used elsewhere */
}


/*ANIMATION SECTION*/
      .wiggle-hover:hover {
      animation: wiggle 0.35s ease-in-out;
    }

    @keyframes wiggle {
      25%   { transform: scale(1) rotate(-3deg); }
      25%  { transform: scale(1.05) rotate(3deg); }
      50%  { transform: scale(1.14) rotate(-3deg); }
      75%  { transform: scale(1.08) rotate(3deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
  
  /* Side nav border matches milestone boxes */
  .side-nav {
    border-right: 1px solid #d1d5db;
  }

  /* Icon + label layout */
  .side-nav .nav-links a {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  /* Hide labels when collapsed */
  .side-nav:not(.expanded) .nav-links .label {
    display: none;
  }
  /* Show labels when expanded */
  .side-nav.expanded .nav-links .label {
    display: inline;
  }
  /* Center icons when collapsed */
  .side-nav:not(.expanded) .nav-links a {
    justify-content: center;
  }

  
  /* Match hover style to milestone boxes */
  .side-nav .nav-links a:hover {
    background-color: #f3f4f6;
    color: #111827;
  }

  
  /* Make the tab bar span full width so the right column aligns with the first card */
  .button-tabs { grid-column: 1 / -1; }
  .content { align-items: start; } /* ensure top alignment across grid rows */

    /* === Checkpoint dropdown (file icon) + subtasks (non-destructive retrofit) === */
    .checkpoint-wrapper { width: 100%; }
    .checkpoint-row, .milestone-item { position: relative; }
    .checkpoint-toggle {
      position: absolute; right: 45px; top: 6px;
      border: 0px solid #d1d5db; background:#fff; border-radius:6px; padding:6px 6px; cursor:pointer;
      font-size:18px; display:inline-flex; align-items:center; gap:6px;
    }
    .checkpoint-toggle:hover { background:#f3f4f6; }
    .checkpoint-toggle[aria-expanded="true"] { background:#eef2ff; border-color:#a5b4fc; }
    .checkpoint-subtasks { margin: 6px 75px 2px 55px; display:none; }
    .checkpoint-subtasks.open { display:block; }
    .subtask-list { display:grid; gap:6px; }
    .subtask-row { display:grid; grid-template-columns: 18px 18px 1fr; align-items:center; gap:8px; padding:6px 8px; border:1px solid #dbdbdb; border-radius:6px; }
    .drag-handle { user-select:none; font-size:16px; line-height:1; }
    .subtask-text { outline:none;  min-width:0; }
    .subtask-row[draggable="true"] { cursor:grab; }
    .subtask-row.dragging { opacity:.6; }
    .subtask-add { margin-top:6px; font-size:12px; border:1px solid #d1d5db; background:#f9fafb; border-radius:6px; padding:4px 8px; cursor:pointer; font-weight:600; }
    .subtask-add:hover { background:#f3f4f6; }
    .drop-target-above { box-shadow: inset 0 3px 0 0 #cbd5e1; }
    .drop-target-below { box-shadow: inset 0 -3px 0 0 #cbd5e1; }

  

/* === Subtask checkbox (injected) === */
.subtask-checkbox { margin: 0 6px 0 2px; 
  width: 16px;
  height: 16px;
  border: 1.5px solid #cbd5e1;
  border-radius: 4px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  user-select: none;
  font-size: 12px;
  line-height: 1;
  background: #fff;
  padding: 0;
}
.subtask-checkbox:focus-visible {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}
.subtask-row.done .subtask-checkbox { margin: 0 6px 0 2px; 
  background: #10b981;
  border-color: #059669;
  color: #fff;
}
.subtask-row.done .subtask-text {
  text-decoration: line-through;
  color: #6b7280;
}
.subtask-row {
        color: #4a5568;
      line-height: 1.5;
      font-weight: 400;
      font-size: 12px;
      font-style: italic;
}

/* === Collapsible right-column cards === */
.card.collapsible { position: relative; overflow: hidden; }
.card.collapsible .collapsible-content { margin-top: 8px; }
.card.collapsible .expand-handle {
  position: absolute;
  top: 0; right: 0;
  width: 5px; height: 100%;
  cursor: pointer;
  display: block;
  z-index: 2;
  background: linear-gradient(to left, rgba(210,210,210,0.45), rgba(210,210,210,0.05));
  transition: box-shadow .18s ease, background .18s ease, filter .18s ease;
}
.card.collapsible .expand-handle:hover {
  box-shadow: inset -4px 0 0 rgba(210,210,210,0.45);
  filter: saturate(1.05);
}




/* Collapsed state hides everything except the section title */
.card.collapsible.collapsed .collapsible-content { display: none; }

/* Ensure the title isn't covered by the handle */
.card.collapsible .section-title { position: relative; z-index: 3; padding-right: 42px; }


/* === Project Wins milestone pill === */
.win-pill{
  position: relative;
  display: block;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  margin-top: 6px;
  padding: 8px 10px;
  border-radius: 9999px;
  /*background: rgba(139,244,173,0.0);*/
  /*border: 1px solid rgba(139,139,139,0.35);*/
  font-size: 12px;
  line-height: 1.2;
}

.win-pill label{
  font-weight: 700;
  opacity: 0.85;
  margin-right: 8px;
}

.win-dropdown-toggle{
  border: 1px solid #d1d5db;
  border-radius: 9999px;
  padding: 4px 10px;
  background: #fff;
  cursor: pointer;
  font-size: 12px;
}

.win-selected{
  display: inline-block;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: middle;
}

.win-dropdown{
  position: absolute;
  left: 10px;
  right: 10px;
  top: calc(100% + 6px);
  max-height: 240px;
  overflow: auto;
  background: #fff;
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  z-index: 1000;
}

.win-dropdown[hidden]{ display: none; }

/* Allow overlap only while open */
.card.dropdown-open { overflow: visible; position: relative; z-index: 200; }


/* === Safe Project JSON Export (non-intrusive) === */
.json-export-divider { border: 0; border-top: 1px solid #e1e5e9; margin: 24px 0 12px; }
.json-export-pane { background: #0b1220; color: #e5e7eb; border-radius: 8px; padding: 12px; border: 1px solid #1f2937; overflow: hidden; }
.json-export-pane .json-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-weight: 700; color: #a7b0be; font-size: 12px; letter-spacing: .4px; text-transform: uppercase; }
.json-export-pane pre { margin: 0; max-height: 360px; overflow: auto; font-size: 12px; line-height: 1.45; }
.json-export-pane .json-actions { display: flex; gap: 8px; }
.json-export-pane .json-btn { background: #111827; color: #e5e7eb; border: 1px solid #374151; border-radius: 6px; padding: 4px 8px; font-size: 12px; font-weight: 700; cursor: pointer; }
.json-export-pane .json-btn:hover { background: #1f2937; }


    /* === Value Opportunity (editable) === */
    .value-items {
      position: relative;
      display: flex;
      align-items: baseline;
      gap: 1px;
      padding-right: 28px; /* room for delete button */
    }
    .value-title {
      font-weight: 700;
      color: #4c4a4a;
      outline: none;
      border: 1px dashed transparent;
      padding: 0px 0px;
      border-radius: 3px;
      text-transform: uppercase;
    }
    .value-title:focus {
      border-color: rgb(19,244,173);
      background: #fafafa;
    }
    .value-text {
      outline: none;
      border: 1px dashed transparent;
      padding: 2px 4px;
      border-radius: 3px;
      flex: 1;
    }
    .value-text:focus {
      border-color: rgb(19,244,173);
      background: #fafafa;
    }
    .delete-value {
      position: absolute;
      right: 4px;
      top: 6px;
      background: transparent;
      border: none;
      color: #6b7280;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }
    .value-items:hover .delete-value { display: flex; }

</style>
  <script>
    function addStakeholder(containerId) {
  const container = document.getElementById(containerId);
  const newMember = document.createElement('div');
  newMember.className = 'stakeholders-member';
  
  newMember.innerHTML = `
    <div class="stakeholders-items" contenteditable="true">NEW STAKEHOLDER</div>
    <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
  `;
  
  container.appendChild(newMember);

  const nameField = newMember.querySelector('.stakeholders-items');
  nameField.focus();
  nameField.select();
}

    function addProjectLead(containerId) {
      const container = document.getElementById(containerId);
      const newMember = document.createElement('div');
      newMember.className = 'team-member';
      
      newMember.innerHTML = `
        <div class="member-name" contenteditable="true">New Team Member</div>
        <div class="member-role" contenteditable="true">Enter role here</div>
        <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
      `;
      
      container.appendChild(newMember);
      
      // Focus on the name field for immediate editing
      const nameField = newMember.querySelector('.member-name');
      nameField.focus();
      nameField.select();
    }

    function addWins(containerId) {
      const container = document.getElementById(containerId);
      const newMember = document.createElement('div');
      newMember.className = 'team-member';
      
      newMember.innerHTML = `
        <div class="member-name" contenteditable="true">Win Title</div>
        <div class="member-role" contenteditable="true">Win Summary...</div>
        <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
      `;
      
      container.appendChild(newMember);
      
      // Focus on the name field for immediate editing
      const nameField = newMember.querySelector('.member-name');
      nameField.focus();
      nameField.select();
    }

function deleteMember(button) {
  let member = button.closest('.team-member');
  if (!member) {
    member = button.closest('.stakeholders-member');
  }
  if (member) {
    member.remove();
  }
}

      function addMilestoneBox() {
        const container = document.getElementById('milestone-container');
        const box = document.createElement('div');
        box.className = 'milestone-box';
        box.innerHTML = `
          <div class="milestone-title" contenteditable="true">New Milestone Title</div>
          <div class="milestone-toolbar">
                  <span>üèÜ <span class="count">4</span></span>
                  <span>üì¢ <span class="count">28</span></span>
                  <span>üí¨<span class="count"></span></span>
          </div>
          <div class="milestone-items"></div>
          <button class="add-button" onclick="addMilestoneItem(this)">+ Add Checkpoint</button>
        `;
        container.appendChild(box);

        const titleField = box.querySelector('.milestone-title');
        titleField.focus();
        titleField.select();
      }

    function addMilestoneItem(button) {
      const itemsContainer = button.previousElementSibling;
      const item = document.createElement('div');
      item.className = 'milestone-item';
      
      // Create unique ID for this dropdown
      const dropdownId = 'dropdown-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      
      item.innerHTML = `
        <div class="color-dropdown" id="${dropdownId}">
          <div class="dropdown-button" onclick="toggleDropdown('${dropdownId}')" tabindex="0" role="button" aria-haspopup="listbox" aria-expanded="false">
            <div class="color-indicator clear"></div>
            <div class="dropdown-arrow">‚ñº</div>
          </div>
          <div class="dropdown-menu" role="listbox">
            <div class="dropdown-option" data-status="clear" onclick="selectOption('${dropdownId}', 'clear', 'Not Started')" role="option">
              <div class="color-indicator clear"></div>
              <span>Not Started</span>
            </div>
            <div class="dropdown-option" data-status="green" onclick="selectOption('${dropdownId}', 'green', 'Done')" role="option">
              <div class="color-indicator green"></div>
              <span>Done</span>
            </div>
            <div class="dropdown-option" data-status="yellow" onclick="selectOption('${dropdownId}', 'yellow', 'In Progress')" role="option">
              <div class="color-indicator yellow"></div>
              <span>In Progress</span>
            </div>
            <div class="dropdown-option" data-status="red" onclick="selectOption('${dropdownId}', 'red', 'Blocked')" role="option">
              <div class="color-indicator red"></div>
              <span>Blocked</span>
            </div>
          </div>
        </div>
                    <div class="milestone-item-left">
          <div class="milestone-item-content" contenteditable="false">
                     <select class="milestone-month wiggle-hover" contenteditable="false">
            <option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option>
            <option>May</option><option>Jun</option><option>Jul</option><option>Aug</option>
            <option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option>
          </select>
          <span>: </span> <span contenteditable="true">New Milestone Checkpoint</span>
        </div>
        <div class="milestone-item-meta">
      üóÇÔ∏è <span class="count">0</span>
      <button onclick="incrementCard(this)">+</button>


    </div>
      `;
      itemsContainer.appendChild(item);
      
      // Focus on the text field for immediate editing
      const textField = item.querySelector('.milestone-item-content');
      textField.focus();
      document.execCommand('selectAll', false, null);
    }

    function deleteItemOnEmpty(event, element) {
      if ((event.key === 'Backspace' || event.key === 'Delete') && element.innerText.trim() === '') {
        const milestoneItem = element.closest('.milestone-item');
        if (milestoneItem) {
          milestoneItem.remove();
        }
      }
    }

    // Color dropdown functions
    function toggleDropdown(dropdownId) {
      const dropdown = document.getElementById(dropdownId);
      const button = dropdown.querySelector('.dropdown-button');
      const menu = dropdown.querySelector('.dropdown-menu');
      
      // Close other dropdowns
      document.querySelectorAll('.color-dropdown').forEach(d => {
        if (d.id !== dropdownId) {
          d.querySelector('.dropdown-button').classList.remove('open');
          d.querySelector('.dropdown-menu').classList.remove('open');
          d.querySelector('.dropdown-button').setAttribute('aria-expanded', 'false');
        }
      });
      
      // Toggle current dropdown
      const isOpen = button.classList.contains('open');
      button.classList.toggle('open');
      menu.classList.toggle('open');
      button.setAttribute('aria-expanded', !isOpen);
    }

    function selectOption(dropdownId, color, text) {
      const dropdown = document.getElementById(dropdownId);
      const button = dropdown.querySelector('.dropdown-button');
      const colorElement = button.querySelector('.color-indicator');
      
      colorElement.className = `color-indicator ${color}`;
      
      // Close dropdown
      button.classList.remove('open');
      dropdown.querySelector('.dropdown-menu').classList.remove('open');
      button.setAttribute('aria-expanded', 'false');
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.color-dropdown')) {
        document.querySelectorAll('.color-dropdown').forEach(dropdown => {
          dropdown.querySelector('.dropdown-button').classList.remove('open');
          dropdown.querySelector('.dropdown-menu').classList.remove('open');
          dropdown.querySelector('.dropdown-button').setAttribute('aria-expanded', 'false');
        });
      }
    });
    function toggleSideNav() {
      document.getElementById('sideNav').classList.toggle('expanded');
    }

    function toggleCommentsPanel() {
      document.getElementById('commentsPanel').classList.toggle('open');
    }

    function addComment() {
      const textArea = document.getElementById('commentText');
      const body = document.getElementById('commentsBody');
      const text = textArea.value.trim();
      if (text) {
        const item = document.createElement('div');
        item.className = 'comment-item';
        item.textContent = text;
        body.appendChild(item);
        textArea.value = '';
        body.scrollTop = body.scrollHeight; // auto scroll
      }
    }
    function incrementCard(button) {
  const countSpan = button.previousElementSibling;
  let value = parseInt(countSpan.textContent || "0", 10);
  countSpan.textContent = value + 1;
}

// Show/hide the inline form
  function showResourceForm() {
    document.getElementById('resource-form').style.display = 'grid';
    document.getElementById('resource-name').focus();
  }
  function cancelResource() {
    document.getElementById('resource-form').style.display = 'none';
    document.getElementById('resource-name').value = '';
    document.getElementById('resource-link').value = '';
  }

  // Basic URL sanitization (allow only http/https)
  function sanitizeUrl(url) {
    try {
      const u = new URL(url);
      if (u.protocol !== 'http:' && u.protocol !== 'https:') return null;
      return u.toString();
    } catch { return null; }
  }

  // Save a new resource item
  function saveResource() {
    const nameEl = document.getElementById('resource-name');
    const linkEl = document.getElementById('resource-link');
    const name = nameEl.value.trim();
    const link = sanitizeUrl(linkEl.value.trim());
    if (!name || !link) {
      alert('Please enter a name and a valid https:// link.');
      return;
    }

    const list = document.getElementById('resources-list');
    const item = document.createElement('div');
    item.className = 'resource-item';

    const a = document.createElement('a');
    a.href = link;
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.textContent = name;

    const del = document.createElement('button');
    del.className = 'delete-resource';
    del.title = 'Delete resource';
    del.textContent = '√ó';
    del.onclick = () => { item.remove(); saveResourcesToStorage(); };

    item.appendChild(a);
    item.appendChild(del);
    list.appendChild(item);

    saveResourcesToStorage();
    cancelResource();
  }

  // Persist list to localStorage (handy for demos)
  function saveResourcesToStorage() {
    const items = Array.from(document.querySelectorAll('#resources-list .resource-item a'))
      .map(a => ({ name: a.textContent, link: a.href }));
    try { localStorage.setItem('project_resources', JSON.stringify(items)); } catch {}
  }
  function loadResourcesFromStorage() {
    try {
      const raw = localStorage.getItem('project_resources');
      if (!raw) return;
      const items = JSON.parse(raw);
      const list = document.getElementById('resources-list');
      items.forEach(({name, link}) => {
        const item = document.createElement('div');
        item.className = 'resource-item';
        const a = document.createElement('a');
        a.href = link; a.target = '_blank'; a.rel = 'noopener noreferrer';
        a.textContent = name;
        const del = document.createElement('button');
        del.className = 'delete-resource'; del.title = 'Delete resource'; del.textContent = '√ó';
        del.onclick = () => { item.remove(); saveResourcesToStorage(); };
        item.appendChild(a); item.appendChild(del);
        list.appendChild(item);
      });
    } catch {}
  }
  document.addEventListener('DOMContentLoaded', loadResourcesFromStorage);
  
    /* === Subtasks utilities === */
    let openCheckpointEl = null;
    function toggleCheckpointSubtasks(btn){
      const panel = btn.closest('.checkpoint-wrapper')?.querySelector('.checkpoint-subtasks') ||
                    btn.closest('.milestone-item')?.nextElementSibling;
      if (!panel) return;
      const isOpen = panel.classList.contains('open');
      if (openCheckpointEl && openCheckpointEl !== panel){
        openCheckpointEl.classList.remove('open');
        const prevBtn = openCheckpointEl._toggleBtn;
        if (prevBtn) prevBtn.setAttribute('aria-expanded','false');
      }
      if (isOpen){
        panel.classList.remove('open');
        btn.setAttribute('aria-expanded','false');
        openCheckpointEl = null;
      } else {
        panel.classList.add('open');
        btn.setAttribute('aria-expanded','true');
        panel._toggleBtn = btn;
        openCheckpointEl = panel;
      }
    }
    document.addEventListener('click', (e)=>{
      if (!openCheckpointEl) return;
      if (e.target.closest('.checkpoint-wrapper') || e.target.closest('.checkpoint-subtasks')) return;
      openCheckpointEl.classList.remove('open');
      const prevBtn = openCheckpointEl._toggleBtn;
      if (prevBtn) prevBtn.setAttribute('aria-expanded','false');
      openCheckpointEl = null;
    });
    function addSubtaskRow(listId, initialText){
  const list = document.getElementById(listId);
  const row = document.createElement('div');
  row.className = 'subtask-row';
  row.setAttribute('draggable','true');

  const handle = document.createElement('span');
  handle.className = 'drag-handle';
  handle.textContent = '‚ãÆ‚ãÆ';

  const checkbox = (typeof createSubtaskCheckbox === 'function')
    ? createSubtaskCheckbox()
    : (function(){ const b=document.createElement('button'); b.className='subtask-checkbox'; b.addEventListener('click',()=>{ const d=row.classList.toggle('done'); b.textContent=d?'‚úì':'';}); return b; })();

  const text = document.createElement('div');
  text.className = 'subtask-text';
  text.contentEditable = 'true';
  text.textContent = (initialText || 'New task');

  row.appendChild(handle);
  row.appendChild(checkbox);
  row.appendChild(text);

  // attachRowDnD is assumed to exist in the original app
  if (typeof attachRowDnD === 'function') { attachRowDnD(row); }
  list.appendChild(row);

  // focus caret to end of text
  try {
    const r = document.createRange(); r.selectNodeContents(text);
    r.collapse(false); const s = window.getSelection();
    s.removeAllRanges(); s.addRange(r);
    text.focus();
  } catch(e){}
}
function enableListDnD(list){
      list.addEventListener('dragover', (e)=>{
        e.preventDefault();
        const dragging = document.querySelector('.subtask-row.dragging'); if (!dragging) return;
        const after = getDragAfterElement(list, e.clientY);
        Array.from(list.children).forEach(c => c.classList.remove('drop-target-above','drop-target-below'));
        if (after == null) { if (list.lastElementChild) list.lastElementChild.classList.add('drop-target-below'); }
        else { after.classList.add('drop-target-above'); }
      });
      list.addEventListener('dragleave', ()=>{
        Array.from(list.children).forEach(c => c.classList.remove('drop-target-above','drop-target-below'));
      });
      list.addEventListener('drop', (e)=>{
        e.preventDefault();
        const dragging = document.querySelector('.subtask-row.dragging'); if (!dragging) return;
        const after = getDragAfterElement(list, e.clientY);
        Array.from(list.children).forEach(c => c.classList.remove('drop-target-above','drop-target-below'));
        if (after == null) list.appendChild(dragging); else list.insertBefore(dragging, after);
      });
    }
    function attachRowDnD(row){
      const handle = row.querySelector('.drag-handle');
      row.addEventListener('dragstart', ()=> row.classList.add('dragging'));
      row.addEventListener('dragend', ()=> row.classList.remove('dragging'));
      row.addEventListener('mousedown', (e)=>{ row.setAttribute('draggable', handle.contains(e.target) ? 'true' : 'false'); });
      row.addEventListener('mouseup', ()=> row.setAttribute('draggable', 'true'));
    }
    function getDragAfterElement(container, y){
      const els=[...container.querySelectorAll('.subtask-row:not(.dragging)')];
      return els.reduce((closest, child)=>{
        const box=child.getBoundingClientRect();
        const offset=y - box.top - box.height/2;
        if (offset<0 && offset>closest.offset) return {offset, element: child};
        else return closest;
      }, {offset: Number.NEGATIVE_INFINITY}).element;
    }

    /* === Retrofit existing checkpoints & enhance addMilestoneItem, non-destructively === */
    function retrofitExistingCheckpoints(){
      document.querySelectorAll('.milestone-box').forEach(box => {
        const items = box.querySelectorAll('.milestone-item');
        items.forEach(item => {
          // Skip if already processed
          if (item._retrofitted) return;
          item._retrofitted = true;
          const wrapper = document.createElement('div');
          wrapper.className = 'checkpoint-wrapper';
          item.parentNode.insertBefore(wrapper, item);
          wrapper.appendChild(item);
          // File icon button
          const btn = document.createElement('button');
          btn.className = 'checkpoint-toggle'; btn.setAttribute('aria-expanded','false');
          btn.innerHTML = '<span class="icon wiggle-hover">üóÇÔ∏è</span>';
          btn.title = 'Open tasks';
          btn.onclick = function(){ toggleCheckpointSubtasks(btn); };
          item.appendChild(btn);
          // Subtasks panel
          const listId = 'cp-list-' + Date.now() + '-' + Math.random().toString(36).slice(2);
          const panel = document.createElement('div');
          panel.className = 'checkpoint-subtasks';
          panel.innerHTML = '<div id="'+listId+'" class="subtask-list"></div>' +
                            '<button class="subtask-add" onclick="addSubtaskRow(\''+listId+'\')">+ Add Row</button>';
          wrapper.appendChild(panel);
          // init
          enableListDnD(panel.querySelector('.subtask-list'));
          addSubtaskRow(listId, 'First task for this checkpoint');
        });
      });
    }

    // Enhance addMilestoneItem by wrapping the original if present
    (function(){
      const original = window.addMilestoneItem;
      window.addMilestoneItem = function(button){
        if (typeof original === 'function') original(button);
        // After original adds a .milestone-item at the end, retrofit just the last one
        const itemsContainer = button.previousElementSibling;
        const lastItem = itemsContainer && itemsContainer.querySelector('.milestone-item:last-of-type');
        if (lastItem) {
          // If not yet retrofitted, do the same flow as retrofitExistingCheckpoints for that item
          if (!lastItem._retrofitted) {
            lastItem._retrofitted = true;
            const wrapper = document.createElement('div'); wrapper.className='checkpoint-wrapper';
            itemsContainer.insertBefore(wrapper, lastItem);
            wrapper.appendChild(lastItem);
            const btn = document.createElement('button'); btn.className='checkpoint-toggle'; btn.setAttribute('aria-expanded','false');
            btn.innerHTML = '<span class="icon wiggle-hover">üóÇÔ∏è</span>'; btn.title='Open tasks'; btn.onclick = function(){ toggleCheckpointSubtasks(btn); };
            lastItem.appendChild(btn);
            const listId = 'cp-list-' + Date.now() + '-' + Math.random().toString(36).slice(2);
            const panel = document.createElement('div'); panel.className='checkpoint-subtasks';
            panel.innerHTML = '<div id="'+listId+'" class="subtask-list"></div>' +
                              '<button class="subtask-add" onclick="addSubtaskRow(\''+listId+'\')">+ Add Row</button>';
            wrapper.appendChild(panel);
            enableListDnD(panel.querySelector('.subtask-list'));
            addSubtaskRow(listId, 'First task for this checkpoint');
          }
        }
      };
      document.addEventListener('DOMContentLoaded', retrofitExistingCheckpoints);
    })();

  
    function addUpdate(containerId) {
      const container = document.getElementById(containerId);
      const update = document.createElement('div');
      update.className = 'team-member';

      const now = new Date();
      const ts = now.toLocaleString(); // uses user's locale

      update.innerHTML = `
        <div class="member-name" contenteditable="false">${ts}</div>
        <div class="member-role" contenteditable="true">Update Title‚Ä¶</div>
        <div class="member-role" contenteditable="true">Details about this update‚Ä¶</div>
        <button class="delete-member" onclick="deleteMember(this)" title="Delete update">√ó</button>
      `;

      container.appendChild(update);

      // Focus the title field for quick typing
      const titleField = update.querySelector('.member-role');
      if (titleField) { titleField.focus(); document.execCommand && document.execCommand('selectAll', false, null); }
    }

</script>
</head>
<body>
  <div class="banner">Project Plan V1</div>
  <div class="content">

      <div class="button-tabs">
        <button class="active">Select Project</button>
        <button>All Projects</button>
        <button>Roadmap</button>
      </div>
      
    <div class="grid-left"><div class="card">
        <div class="project-title" contenteditable="true">BIG IMPORTANT PROJECT FOCUSED ON WORK</div>
        <div class="status-item">
        <div class="status-label">VISION:</div>
        <div class="status-text" contenteditable="true">One sentence vision statement.</div>
        </div>
        <div class="status-item">
        <div class="status-label">CURRENT STATE:</div>
        <div class="status-text" contenteditable="true">Next-generation heavy-lift rocket capable of delivering crew and cargo to lunar orbit and beyond as part of the Artemis program, supporting NASA's long-term goals of Moon colonization and Mars exploration to develop a next-generation heavy-lift rocket capable of delivering crew and cargo to lunar orbit and beyond as part of the Artemis program, supporting NASA's long-term goals of Moon colonization and Mars exploration.</div>
        </div>
        <div class="status-item">
        <div class="status-label">IDEAL FUTURE STATE:</div>
        <div class="status-text" contenteditable="true">Next-generation heavy-lift rocket capable of delivering crew and cargo to lunar orbit and beyond as part of the Artemis program, supporting NASA's long-term goals of Moon colonization and Mars exploration to develop a next-generation heavy-lift rocket capable of delivering crew and cargo to lunar orbit and beyond as part of the Artemis program, supporting NASA's long-term goals of Moon colonization and Mars exploration.</div>
        </div>
        <div class="status-label">VALUE OPPORTUNITY:</div>
        <div class="list-section" id="value-opportunity">
          <div class="value-items">SPONSOR: <span class="value-text" contenteditable="true">One sentence objective.</span></div>
          <div class="value-items">IMPACT: <span class="value-text" contenteditable="true">One sentence objective.</span></div>
          <div class="value-items">LEVEL OF EFFORT: <span class="value-text" contenteditable="true">One sentence objective.</span></div>
          <div class="value-items">CONFIDENCE: <span class="value-text" contenteditable="true">One sentence objective.</span></div>
        </div>
        <button class="add-button" onclick="addValueItem('value-opportunity')">Add Value</button>
      </div>
      <div class="card">
        <div class="section-title">KEY MILESTONES: </div>
        <div id="milestone-container">
          <div class="milestone-box">
            <div class="milestone-title" contenteditable="true">25Q1: Finalization of rocket specifications</div>
              <div class="milestone-toolbar">
                  <span>üèÜ <span class="count">4</span></span>
                  <span>üì¢ <span class="count">28</span></span>
                  <span>üí¨<span class="count"></span></span>
              </div>
            <div class="milestone-items">
              <div class="milestone-item">
                <div class="color-dropdown" id="dropdown-1">
                  <div class="dropdown-button" onclick="toggleDropdown('dropdown-1')" tabindex="0" role="button" aria-haspopup="listbox" aria-expanded="false">
                    <div class="color-indicator clear"></div>
                    <div class="dropdown-arrow">‚ñº</div>
                  </div>
                  <div class="dropdown-menu" role="listbox">
                    <div class="dropdown-option" data-status="clear" onclick="selectOption('dropdown-1', 'clear', 'Not Started')" role="option">
                      <div class="color-indicator clear">'‚úì'</div>
                      <span>Not Started</span>
                    </div>
                    <div class="dropdown-option" data-status="green" onclick="selectOption('dropdown-1', 'green', 'Done')" role="option">
                      <div class="color-indicator green"></div>
                      <span>Done</span>
                    </div>
                    <div class="dropdown-option" data-status="yellow" onclick="selectOption('dropdown-1', 'yellow', 'In Progress')" role="option">
                      <div class="color-indicator yellow"></div>
                      <span>In Progress</span>
                    </div>
                    <div class="dropdown-option" data-status="red" onclick="selectOption('dropdown-1', 'red', 'Blocked')" role="option">
                      <div class="color-indicator red"></div>
                      <span>Blocked</span>
                    </div>
                  </div>
                </div>
            <div class="milestone-item-left">
          <div class="milestone-item-content" contenteditable="false">
                     <select class="milestone-month wiggle-hover" contenteditable="false">
            <option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option>
            <option>May</option><option>Jun</option><option>Jul</option><option>Aug</option>
            <option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option>
          </select>
          <span>: </span> <span contenteditable="true">1.1 Requirements gathering from mission architecture</span></div>
        </div>
        <div class="milestone-item-meta">
          üóÇÔ∏è <span class="count">0</span>
          <button onclick="incrementCard(this)">+</button>
            </div>
            </div>
        </div>
            <button class="add-button" onclick="addMilestoneItem(this)">+ Add Checkpoint</button>
          </div>
        </div>
        <button class="add-button" onclick="addMilestoneBox()">+ Add Milestone</button>
      </div>
    </div>
    <div class="grid-right">
      <div class="card">
        <div class="section-title">PROJECT LEADS:</div>
        <div class="list-section" id="project-leads">
          <div class="team-member">
            <div class="member-name" contenteditable="true">Melissa Hargrove</div>
            <div class="member-role" contenteditable="true">Director, Advanced Propulsion Systems</div>
            <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
          <div class="team-member">
            <div class="member-name" contenteditable="true">Allen Reyes</div>
            <div class="member-role" contenteditable="true">Chief Aerospace Engineer</div>
            <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
          <div class="team-member">
            <div class="member-name" contenteditable="true">Naomi Li</div>
            <div class="member-role" contenteditable="true">Program Manager, Artemis Integration Office</div>
            <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
        </div>
        <button class="add-button" onclick="addProjectLead('project-leads')">+ Add Lead</button>
      </div>
      <div class="card">
        <div class="section-title">STAKEHOLDERS:</div>
        <div class="list-section" id="stakeholders">
          <div class="stakeholders-member">
          <div class="stakeholders-items" contenteditable="true">Melissa Hargrove</div>
          <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
          <div class="stakeholders-member">
          <div class="stakeholders-items" contenteditable="true">NEW STAKEHOLDER</div>
          <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
          <div class="stakeholders-member">
          <div class="stakeholders-items" contenteditable="true">NEW STAKEHOLDER</div>
          <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
        </div>
        <button class="add-button" onclick="addStakeholder('stakeholders')">+ Add Stakeholder</button>
      </div>
          <!-- RESOURCES CONTAINER -->
<div class="card">
  <div class="section-title">RESOURCES:</div>

  <div class="list-section" id="resources-list">
    <!-- Resource items will appear here -->
  </div>

  <!-- Inline form (hidden until "Add Resource" is pressed) -->
  <div class="resource-form" id="resource-form" style="display:none;">
    <input type="text" id="resource-name" placeholder="Name (e.g., Design Brief)" />
    <input type="url" id="resource-link" placeholder="Link (https://‚Ä¶)" />
    <button class="save-btn" onclick="saveResource()">Save</button>
    <button class="cancel-btn" onclick="cancelResource()">Cancel</button>
  </div>

  <button class="add-button" onclick="showResourceForm()">+ Add Resource</button>
</div>
<!--WINS CONTAINER -->
      <div class="card">
        <div class="section-title">PROJECT WINS:</div>
        <div class="list-section" id="project-wins">
          <div class="team-member">
            <div class="member-name" contenteditable="true">Phase 1 Complete with 30% Time Savings</div>
            <div class="member-role" contenteditable="true">Amazing results from the team, deliverying Phase 1 of the project on time, this unlocks some massive time savings of 30% dropping us from 100ms of load time to 70ms. Shout out to Dev Patel for getting this to the finish line!</div>
            <button class="delete-member" onclick="deleteMember(this)" title="Delete member">√ó</button>
          </div>
      </div>
      <button class="add-button" onclick="addWins('project-wins')">+ Add Win</button>
    </div>
    <!--UPDATES CONTAINER -->
      <div class="card">
        <div class="section-title">PROJECT UPDATES:</div>
        <div class="list-section" id="project-updates">
          <!-- New updates will appear here -->
        </div>
        <button class="add-button" onclick="addUpdate('project-updates')">+ Add Update</button>
      </div>

    </div>
  </div>
<!-- Comments Panel -->
<div class="comments-panel" id="commentsPanel">
  <div class="comments-header">Comments</div>
  <div class="comments-body" id="commentsBody"></div>
  <div class="comment-input">
    <textarea id="commentText" rows="1" placeholder="Write a comment..."></textarea>
    <button onclick="addComment()">Send</button>
  </div>
</div>

<!-- Subtask checkbox helpers (injected) -->
<script>
(function(){
  function createSubtaskCheckbox() {
    const box = document.createElement('button');
    box.className = 'subtask-checkbox';
    box.setAttribute('aria-pressed', 'false');
    box.setAttribute('title', 'Mark complete');
    box.addEventListener('click', function (e) {
      e.stopPropagation();
      toggleSubtaskDone(box);
    });
    box.addEventListener('keydown', function (e) {
      if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); toggleSubtaskDone(box); }
    });
    return box;
  }
  function toggleSubtaskDone(box) {
    const row = box.closest('.subtask-row');
    if (!row) return;
    const isDone = row.classList.toggle('done');
    box.setAttribute('aria-pressed', String(isDone));
    box.textContent = isDone ? '‚úì' : '';
  }
  function upgradeSubtaskCheckboxes() {
    document.querySelectorAll('.subtask-row').forEach(row => {
      if (!row.querySelector('.subtask-checkbox')) {
        const handle = row.querySelector('.drag-handle');
        const box = createSubtaskCheckbox();
        if (handle && handle.nextSibling) {
          row.insertBefore(box, handle.nextSibling);
        } else {
          row.insertBefore(box, row.firstChild);
        }
      }
    });
  }
  // Expose minimal API if addSubtaskRow is defined later and uses createSubtaskCheckbox()
  window.createSubtaskCheckbox = window.createSubtaskCheckbox || createSubtaskCheckbox;
  window.upgradeSubtaskCheckboxes = window.upgradeSubtaskCheckboxes || upgradeSubtaskCheckboxes;

  document.addEventListener('DOMContentLoaded', function(){
    try { upgradeSubtaskCheckboxes(); } catch(e) {}
  });
})();
</script>

<script>

/* === Collapsible Cards (right column) === */
(function(){
  function setupCollapsibleCard(card){
    if (!card || card.classList.contains('collapsible')) return;
    card.classList.add('collapsible');
    card.setAttribute('role','region');
    // Find the title
    var title = card.querySelector('.section-title');
    if (!title) return;
    var titleId = 'sec-' + Math.random().toString(36).slice(2);
    title.id = titleId;
    card.setAttribute('aria-labelledby', titleId);

    // Wrap all siblings after the title as content
    var content = document.createElement('div');
    content.className = 'collapsible-content';
    var node = title.nextSibling;
    var moved = false;
    var toMove = [];
    while (node) {
      var next = node.nextSibling;
      toMove.push(node);
      node = next;
    }
    toMove.forEach(function(n){ content.appendChild(n); moved = true; });
    if (moved) card.appendChild(content);

    // Right-edge handle
    var handle = document.createElement('div');
    handle.className = 'expand-handle';
    handle.setAttribute('title','Click to expand/collapse');
    handle.setAttribute('role','button');
    handle.setAttribute('tabindex','0');
    card.appendChild(handle);

    // Icon (stays visible; changes direction)
    // start collapsed by default
    card.classList.add('collapsed');
    card.setAttribute('aria-expanded','false');

    function toggle(){
      var expanded = card.classList.toggle('collapsed') ? false : true;
      card.setAttribute('aria-expanded', String(expanded));
    }
    handle.addEventListener('click', toggle);
    handle.addEventListener('keydown', function(e){
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
    });
  }

  function initRightColumnCollapsibles(){
    var right = document.querySelector('.grid-right');
    if (!right) return;
    var targets = Array.from(right.querySelectorAll('.card'));
    targets.forEach(function(card){
      var title = card.querySelector('.section-title');
      if (!title) return;
      var t = title.textContent.trim().toUpperCase();
      if (t === 'PROJECT LEADS:' || t === 'STAKEHOLDERS:' || t === 'RESOURCES:' || t === 'PROJECT WINS:' || t === 'PROJECT UPDATES:'){
        setupCollapsibleCard(card);
      }
    });
  }

  document.addEventListener('DOMContentLoaded', initRightColumnCollapsibles);
})();

</script>
<script>

/* === Project Wins: milestone pill selector (titles only) === */
(function(){
  function textOf(el){ return (el && (el.textContent || el.innerText) || '').trim(); }

  function collectMilestoneTitles(){
    var titles = [];
    // Find the "KEY MILESTONES" card
    var cards = Array.from(document.querySelectorAll('.card'));
    cards.forEach(function(card){
      var t = textOf(card.querySelector('.section-title')||{}).toUpperCase();
      if (t.indexOf('KEY MILESTONES') !== -1 || t === 'MILESTONES:' || t === 'MILESTONES'){
        card.querySelectorAll('.milestone-title').forEach(function(el){
          var lbl = textOf(el);
          if (lbl) titles.push(lbl);
        });
      }
    });
    // De-dup
    var seen = new Set(), uniq=[];
    titles.forEach(function(x){ if(!seen.has(x)){ seen.add(x); uniq.push(x); }});
    if (uniq.length === 0) uniq = ['(No milestones found)'];
    return uniq;
  }

  function buildMenu(options, onSelect){
    var menu = document.createElement('div');
    menu.className = 'win-dropdown';
    options.forEach(function(name){
      var opt = document.createElement('div');
      opt.className = 'win-option';
      opt.style.padding = '8px 10px';
      opt.style.cursor = 'pointer';
      opt.style.whiteSpace = 'normal';
      opt.style.wordBreak = 'break-word';
      opt.textContent = name;
      opt.addEventListener('click', function(){ onSelect(name); });
      opt.addEventListener('mouseenter', function(){ opt.style.background = 'rgba(19,244,173,0.10)'; });
      opt.addEventListener('mouseleave', function(){ opt.style.background = 'transparent'; });
      menu.appendChild(opt);
    });
    return menu;
  }

  function ensurePill(winEl, milestones){
    if (!winEl || winEl.querySelector('.win-pill')) return;

    var pill = document.createElement('div');
    pill.className = 'win-pill';

    var label = document.createElement('label');
    /*label.textContent = 'Milestone:';

    var toggle = document.createElement('button');
    toggle.type = 'button';
    toggle.className = 'win-dropdown-toggle';
    toggle.textContent = 'Select milestone';

    var selected = document.createElement('span');
    selected.className = 'win-selected';
    selected.hidden = true;*/

    var label = document.createElement('span');
    label.textContent = 'Link milestone';
    label.className = 'win-pill';
    label.style.opacity = '0.7';

    var selected = document.createElement('span');
    selected.className = 'update-selected';
    selected.hidden = true;

    var menu = buildMenu(milestones, function(name){
      selected.textContent = name;
      selected.hidden = false;
      toggle.hidden = true;
      menu.hidden = true;
      var card = winEl.closest('.card');
      if (card) card.classList.remove('dropdown-open');
    });
    menu.hidden = true;

    // Toggle menu open/close
    function openMenu(){
      menu.hidden = false;
      var card = winEl.closest('.card');
      if (card) card.classList.add('dropdown-open');
    }
    function closeMenu(){
      if (menu.hidden) return;
      menu.hidden = true;
      var card = winEl.closest('.card');
      if (card) card.classList.remove('dropdown-open');
    }

    toggle.addEventListener('click', function(e){ e.stopPropagation(); menu.hidden ? openMenu() : closeMenu(); });
    selected.addEventListener('click', function(e){ e.stopPropagation(); toggle.hidden = false; menu.hidden ? openMenu() : closeMenu(); });
    document.addEventListener('click', function(){ closeMenu(); });

    pill.appendChild(label);
    pill.appendChild(toggle);
    pill.appendChild(selected);
    pill.appendChild(menu);

    // Drop the pill under the win's summary if present; else below the title
    var after = winEl.querySelector('.member-role, p, .description, .subtitle, .text');
    if (after) after.insertAdjacentElement('afterend', pill);
    else winEl.appendChild(pill);
  }

  function attachPillsToExisting(milestones){
    var winsRoot = document.getElementById('project-wins');
    if (!winsRoot) return;
    winsRoot.querySelectorAll('.team-member, .project-win, .win-item, .row, li').forEach(function(item){
      ensurePill(item, milestones);
    });
  }

  function watchForNewWins(milestones){
    var winsRoot = document.getElementById('project-wins');
    if (!winsRoot) return;
    var obs = new MutationObserver(function(muts){
      muts.forEach(function(m){
        m.addedNodes && m.addedNodes.forEach(function(n){
          if (n.nodeType === Node.ELEMENT_NODE){
            if (n.classList && (n.classList.contains('team-member') || n.classList.contains('project-win') || n.classList.contains('win-item') || n.classList.contains('row'))){
              ensurePill(n, milestones);
            }
            n.querySelectorAll && n.querySelectorAll('.team-member, .project-win, .win-item, .row, li').forEach(function(it){
              ensurePill(it, milestones);
            });
          }
        });
      });
    });
    obs.observe(winsRoot, {childList: true, subtree: true});
  }

  // Wrap addWins() so the + Add Win button still works as-is, then we attach a pill
  (function(){
    var original = window.addWins;
    window.addWins = function(containerId){
      if (typeof original === 'function') original(containerId);
      try {
        var milestones = collectMilestoneTitles();
        var container = document.getElementById(containerId);
        var last = container && container.querySelector('.team-member:last-of-type');
        if (last) ensurePill(last, milestones);
      } catch(e){ /* no-op */ }
    };
  })();

  

/* === Project Updates: milestone pill selector (titles only) === */
(function(){
  function textOf(el){ return (el && (el.textContent || el.innerText) || '').trim(); }

  function collectMilestoneTitles(){
    var titles = [];
    var cards = Array.from(document.querySelectorAll('.card'));
    cards.forEach(function(card){
      var t = textOf(card.querySelector('.section-title')||{}).toUpperCase();
      if (t.indexOf('KEY MILESTONES') !== -1 || t === 'MILESTONES:' || t === 'MILESTONES'){
        card.querySelectorAll('.milestone-title').forEach(function(el){
          var lbl = textOf(el);
          if (lbl) titles.push(lbl);
        });
      }
    });
    var seen = new Set(), uniq=[];
    titles.forEach(function(x){ if(!seen.has(x)){ seen.add(x); uniq.push(x); } });
    return uniq;
  }

  function buildMenu(options, onSelect){
    var menu = document.createElement('div');
    menu.className = 'win-dropdown'; /* reuse existing dropdown styles */
    options.forEach(function(name){
      var opt = document.createElement('div');
      opt.className = 'win-option';
      opt.style.padding = '8px 10px';
      opt.style.cursor = 'pointer';
      opt.style.whiteSpace = 'normal';
      opt.style.wordBreak = 'break-word';
      opt.textContent = name;
      opt.addEventListener('click', function(){ onSelect(name); });
      opt.addEventListener('mouseenter', function(){ opt.style.background = 'rgba(19,244,173,0.10)'; });
      opt.addEventListener('mouseleave', function(){ opt.style.background = 'transparent'; });
      menu.appendChild(opt);
    });
    return menu;
  }

  function ensurePill(updateEl, milestoneTitles){
    if (!updateEl || updateEl.querySelector('.update-pill-wrap')) return;
    var wrap = document.createElement('div');
    wrap.className = 'update-pill-wrap';
    wrap.style.marginTop = '8px';
    wrap.style.position = 'relative';

    var toggle = document.createElement('span');
    toggle.className = 'win-pill';
    toggle.style.display = 'inline-flex';
    toggle.style.alignItems = 'center';
    toggle.style.gap = '6px';
    toggle.style.cursor = 'pointer';

    var label = document.createElement('span');
    label.textContent = 'Link milestone';
    label.className = 'update-placeholder';
    label.style.opacity = '0.7';

    var selected = document.createElement('span');
    selected.className = 'update-selected';
    selected.hidden = true;

    var chevron = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    chevron.setAttribute('width', '14'); chevron.setAttribute('height', '14'); chevron.setAttribute('viewBox', '0 0 24 24');
    chevron.innerHTML = '<path d="M7 10l5 5 5-5" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round"/>';

    toggle.appendChild(label);
    toggle.appendChild(selected);
    toggle.appendChild(chevron);

    var menu = buildMenu(milestoneTitles, function(name){
      selected.textContent = name;
      selected.hidden = false;
      label.hidden = true;
      closeMenu();
    });
    menu.hidden = true;
    wrap.appendChild(toggle);
    wrap.appendChild(menu);

    function openMenu(){
      menu.hidden = false;
      var card = updateEl.closest('.card');
      if (card) card.classList.add('dropdown-open');
    }
    function closeMenu(){
      if (menu.hidden) return;
      menu.hidden = true;
      var card = updateEl.closest('.card');
      if (card) card.classList.remove('dropdown-open');
    }

    toggle.addEventListener('click', function(e){ e.stopPropagation(); menu.hidden ? openMenu() : closeMenu(); });
    document.addEventListener('click', closeMenu);

    // Place the pill after the roles (title/details) area
    var content = updateEl.querySelector('.member-content') || updateEl;
    content.appendChild(wrap);
  }

  function attachPillsToExisting(milestones){
    var root = document.getElementById('project-updates');
    if (!root) return;
    Array.from(root.querySelectorAll('.team-member')).forEach(function(u){
      ensurePill(u, milestones);
    });
  }

  function watchForNewUpdates(milestones){
    var root = document.getElementById('project-updates');
    if (!root) return;
    var obs = new MutationObserver(function(){
      Array.from(root.querySelectorAll('.team-member')).forEach(function(u){
        ensurePill(u, milestones);
      });
    });
    obs.observe(root, { childList: true, subtree: true });
  }

  function refreshMenus(){
    var milestones = collectMilestoneTitles();
    // Rebuild menus under updates
    document.querySelectorAll('#project-updates .update-pill-wrap').forEach(function(wrap){
      var oldMenu = wrap.querySelector('.win-dropdown');
      if (oldMenu) oldMenu.remove();
      var updateEl = wrap.closest('.team-member');
      var selected = wrap.querySelector('.update-selected');
      var label = wrap.querySelector('.update-placeholder');
      var menu = buildMenu(milestones, function(name){
        selected.textContent = name;
        selected.hidden = false;
        if (label) label.hidden = true;
      });
      menu.hidden = true;
      wrap.appendChild(menu);
    });
  }

  // Observe milestone list for changes and refresh menus when milestones are added/edited/removed
  (function observeMilestones(){
    var milestoneCard = null;
    Array.from(document.querySelectorAll('.card')).forEach(function(card){
      var t = textOf(card.querySelector('.section-title')||{}).toUpperCase();
      if (t.indexOf('KEY MILESTONES') !== -1 || t === 'MILESTONES:' || t === 'MILESTONES'){
        milestoneCard = card;
      }
    });
    if (!milestoneCard) return;
    var obs = new MutationObserver(refreshMenus);
    obs.observe(milestoneCard, { childList: true, subtree: true, characterData: true });
  })();

  // Wrap addUpdate so new items get a pill
  (function(){
    var original = window.addUpdate;
    window.addUpdate = function(containerId){
      if (typeof original === 'function') original(containerId);
      try {
        var milestones = collectMilestoneTitles();
        var container = document.getElementById(containerId);
        var last = container && container.querySelector('.team-member:last-of-type');
        if (last) ensurePill(last, milestones);
      } catch(e){ /* no-op */ }
    };
  })();

  function init(){
    var milestones = collectMilestoneTitles();
    attachPillsToExisting(milestones);
    watchForNewUpdates(milestones);
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();

function init(){
    var milestones = collectMilestoneTitles();
    attachPillsToExisting(milestones);
    watchForNewWins(milestones);
  }
  if (document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
})();

</script>

<hr class="json-export-divider">
<div class="json-export-pane" id="json-export-pane">
  <div class="json-header">
    <span>Project JSON</span>
    <div class="json-actions">
      <button class="json-btn" id="json-refresh-btn" type="button">Refresh</button>
      <button class="json-btn" id="json-copy-btn" type="button">Copy</button>
    </div>
  </div>
  <pre id="json-export-pre">{}</pre>
</div>


<script>
(function(){
  // Everything scoped; zero interference with page handlers.
  function txt(el){ return (el && (el.textContent || el.innerText) || '').trim(); }
  function arr(nl){ return Array.prototype.slice.call(nl || []); }

  function collectProjectSummary(){
    const title = txt(document.querySelector('.project-title'));
    const blocks = arr(document.querySelectorAll('.status-item')).map(it => ({
      label: txt(it.querySelector('.status-label')),
      text: txt(it.querySelector('.status-text'))
    }));
    // Optional value/opportunity if present
    const valueItems = arr(document.querySelectorAll('#value-opportunity .value-items')).map(v => ({
      label: txt(v).split(':')[0],
      text: txt(v.querySelector('.value-text'))
    }));
    return { title, blocks, valueOpportunity: valueItems };
  }

  function collectMilestones(){
    const out = [];
    const root = document.getElementById('milestone-container');
    if (!root) return out;
    root.querySelectorAll('.milestone-box').forEach(box => {
      const title = txt(box.querySelector('.milestone-title'));
      const checkpoints = [];
      box.querySelectorAll('.milestone-item').forEach(item => {
        let status = 'clear';
        const ind = item.querySelector('.color-indicator');
        if (ind){
          if (ind.classList.contains('green')) status = 'green';
          else if (ind.classList.contains('yellow')) status = 'yellow';
          else if (ind.classList.contains('red')) status = 'red';
        }
        const monthSel = item.querySelector('.milestone-month');
        const month = monthSel ? monthSel.value : '';

        const content = item.querySelector('.milestone-item-content [contenteditable="true"]') || item.querySelector('.milestone-item-content');
        const text = txt(content);

        // Subtasks (if present)
        let subtasks = [];
        const wrapper = item.closest('.checkpoint-wrapper');
        const list = wrapper && wrapper.querySelector('.checkpoint-subtasks .subtask-list');
        if (list){
          subtasks = arr(list.querySelectorAll('.subtask-row')).map(row => ({
            text: txt(row.querySelector('.subtask-text')),
            done: row.classList.contains('done')
          }));
        }
        checkpoints.push({ month, status, text, subtasks });
      });
      out.push({ title, checkpoints });
    });
    return out;
  }

  function collectPeople(rootSel){
    const root = document.querySelector(rootSel);
    if (!root) return [];
    return arr(root.querySelectorAll('.team-member')).map(m => ({
      name: txt(m.querySelector('.member-name')),
      role: txt(m.querySelector('.member-role'))
    }));
  }

  function collectStakeholders(){
    const tm = collectPeople('#stakeholders');
    if (tm.length) return tm;
    return arr(document.querySelectorAll('#stakeholders .stakeholders-member .stakeholders-items'))
             .map(s => ({ name: txt(s), role: '' }));
  }

  function collectWins(){
    const root = document.getElementById('project-wins');
    if (!root) return [];
    return arr(root.querySelectorAll('.team-member')).map(w => {
      const title = txt(w.querySelector('.member-name'));
      const summary = txt(w.querySelector('.member-role'));
      const pill = w.querySelector('.win-selected');
      const milestone = pill && !pill.hidden ? txt(pill) : null;
      return { title, summary, linkedMilestone: milestone };
    });
  }

  function collectResources(){
    const root = document.getElementById('resources-list');
    if (!root) return [];
    return arr(root.querySelectorAll('.resource-item a')).map(a => ({
      name: txt(a), link: a.getAttribute('href') || ''
    }));
  }

  function collectAll(){
    return {
      summary: collectProjectSummary(),
      milestones: collectMilestones(),
      projectLeads: collectPeople('#project-leads'),
      stakeholders: collectStakeholders(),
      projectWins: collectWins(),
      resources: collectResources()
    ,
    projectUpdates: collectProjectUpdates()};
  }

  function renderJson(){
    const pre = document.getElementById('json-export-pre');
    if (!pre) return;
    try { pre.textContent = JSON.stringify(collectAll(), null, 2); }
    catch(e){ /* render nothing on error to avoid disruption */ }
  }

  function setupButtons(){
    const refresh = document.getElementById('json-refresh-btn');
    const copy = document.getElementById('json-copy-btn');
    if (refresh) refresh.addEventListener('click', function(){ renderJson(); });
    if (copy) copy.addEventListener('click', async function(){
      const pre = document.getElementById('json-export-pre');
      const text = pre ? pre.textContent : '';
      try{
        await navigator.clipboard.writeText(text);
        copy.textContent = 'Copied!';
        setTimeout(() => copy.textContent = 'Copy', 1200);
      }catch(e){
        copy.textContent = 'Select & Copy';
        setTimeout(() => copy.textContent = 'Copy', 1200);
      }
    });
  }

  // Populate once without attaching any global listeners
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){ setupButtons(); renderJson(); });
  } else {
    setupButtons(); renderJson();
  }
})();

    function collectProjectUpdates(){
      const root = document.getElementById('project-updates');
      if (!root) return [];
      return Array.prototype.slice.call(root.querySelectorAll('.team-member')).map(u => {
        const whenEl = u.querySelector('.member-name');
        const roles = u.querySelectorAll('.member-role');
        const when = (whenEl && (whenEl.textContent || whenEl.innerText) || '').trim();
        const title = roles[0] ? (roles[0].textContent || roles[0].innerText).trim() : '';
        const details = roles[1] ? (roles[1].textContent || roles[1].innerText).trim() : '';
      const pill = u.querySelector('.update-selected');
      const milestone = pill && !pill.hidden ? ((pill.textContent || pill.innerText)||'').trim() : null;
      
      return { timestamp: when, title, details, linkedMilestone: milestone };
      });
    }
    
</script>
<script>

/* === Value Opportunity: make items fully editable + add value button === */
(function(){
  function makeEditableValueItem(el, titleText, bodyText){
    el.classList.add('value-items');
    el.innerHTML = '';
    const title = document.createElement('span');
    title.className = 'value-title';
    title.contentEditable = 'true';
    title.textContent = titleText || 'TITLE';

    const colon = document.createElement('span');
    colon.textContent = ':';

    const text = document.createElement('span');
    text.className = 'value-text';
    text.contentEditable = 'true';
    text.textContent = bodyText || 'Describe the value‚Ä¶';

    const del = document.createElement('button');
    del.className = 'delete-value';
    del.title = 'Delete';
    del.textContent = '√ó';
    del.addEventListener('click', function(){ el.remove(); });

    el.appendChild(title);
    el.appendChild(colon);
    el.appendChild(text);
    el.appendChild(del);
  }

  function retrofitValueItems(rootId){
    const root = document.getElementById(rootId);
    if (!root) return;
    root.querySelectorAll('.value-items').forEach(function(item){
      // If already upgraded (has .value-title), skip
      if (item.querySelector('.value-title')) return;

      // Try to parse "LABEL: <span class='value-text' contenteditable='true'>Body</span>"
      let labelText = '';
      let bodyText = '';
      // Gather all text nodes up to the first colon
      const raw = item.textContent || '';
      const colonIdx = raw.indexOf(':');
      if (colonIdx > -1){
        labelText = raw.slice(0, colonIdx).trim();
      } else {
        labelText = (raw.trim() || 'TITLE');
      }
      // Prefer existing inner span.value-text text for body
      const existingBody = item.querySelector('.value-text');
      if (existingBody){ bodyText = existingBody.textContent.trim(); }

      makeEditableValueItem(item, labelText || 'TITLE', bodyText || 'Describe the value‚Ä¶');
    });
  }

  window.addValueItem = function(containerId){
    const container = document.getElementById(containerId);
    if (!container) return;
    const item = document.createElement('div');
    item.className = 'value-items';
    makeEditableValueItem(item, 'TITLE', 'Describe the value‚Ä¶');
    container.appendChild(item);
    // Focus the new title for quick typing
    const title = item.querySelector('.value-title');
    if (title){ title.focus(); document.execCommand && document.execCommand('selectAll', false, null); }
  };

  document.addEventListener('DOMContentLoaded', function(){
    try { retrofitValueItems('value-opportunity'); } catch(e){}
  });
})();

</script>
</body>
</html>